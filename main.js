(()=>{"use strict";var e,t={baseUrl:"https://mesto.nomoreparties.co/v1/cohort-mag-4/",headers:{authorization:"38ec5425-9537-48f1-96fb-f3fa319e3758","Content-Type":"application/json"}},n=function(e,t){return fetch(e,t).then(o)},o=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},r=function(e){return n("".concat(t.baseUrl,"cards/likes/").concat(e),{method:"DELETE",headers:t.headers}).then((function(e){return console.log(e),e}))},c=function(e){return n("".concat(t.baseUrl,"cards/likes/").concat(e),{method:"PUT",headers:t.headers}).then((function(e){return console.log(e),e}))},a=document.querySelector("#card-template").content,i=function(e){e.classList.remove("popup_is-opened"),setTimeout((function(){e.classList.remove("popup_is-animated")}),1e3),document.removeEventListener("keydown",l),document.removeEventListener("click",s)},u=function(e){e.classList.add("popup_is-animated"),setTimeout((function(){e.classList.add("popup_is-opened")}),0),document.addEventListener("keydown",l),document.addEventListener("click",s)},s=function(e){e.target.classList.contains("popup")&&i(e.target)},l=function(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");t&&i(t)}},d=function(e,t){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove("popup__input_error"),n.classList.remove("popup__form__input-error_active"),n.textContent=""},p=function(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove("popup__button_disabled")):(t.disabled=!0,t.classList.add("popup__button_disabled"))},_=function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(t){d(e,t)})),o.disabled=!0,o.classList.add("popup__button_disabled")},f=document.querySelector(".popup_type_edit"),m=document.querySelector(".popup_type_new-card"),v=document.querySelector(".profile__edit-button"),h=document.querySelector(".profile__add-button"),y=document.querySelectorAll(".popup__close"),b=document.querySelector(".profile__title"),S=document.querySelector(".profile__description"),k=document.querySelector(".profile__image"),L=document.forms.edit__profile,E=document.forms.new__place,g=document.forms.new__avatar,q=document.querySelector(".popup_type_image"),C=document.querySelector(".popup_type_new-avatar"),x=q.querySelector(".popup__image"),A=q.querySelector(".popup__caption"),T=document.querySelector(".places__list"),U={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_error",errorClass:"popup__form__input-error_active"},w=function(e,t){t.submitter.textContent=e?"Сохранение...":"Сохранить"},D=function(e,t,n,o,r){e.classList.contains("card__like-button_is-active")?n(r).then((function(n){t.textContent=n.likes.length,e.classList.remove("card__like-button_is-active")})).catch((function(e){return console.log(e)})):o(r).then((function(n){t.textContent=n.likes.length,e.classList.add("card__like-button_is-active")})).catch((function(e){console.error("Произошла ошибка:",e)}))},P=function(e){var t=e.target;t&&(x.src=t.src,x.alt=t.alt,x.textContent=t.alt,A.textContent=t.alt,u(q))};k.addEventListener("click",(function(e){g.reset,u(C),_(g,U)})),g.addEventListener("submit",(function(e){e.preventDefault();var o,r=g.link.value;w(!0,e),(o=r,n("".concat(t.baseUrl,"users/me/avatar"),{method:"PATCH",headers:t.headers,body:JSON.stringify({avatar:o})})).then((function(){k.style["background-image"]="url('".concat(r,"')")})).catch((function(e){console.error("Произошла ошибка:",e)})).finally((function(){w(!1,e),i(C),g.reset}))})),L.addEventListener("submit",(function(e){e.preventDefault();var o=L.name.value,r=L.description.value;w(!0,e),function(e,o){return n("".concat(t.baseUrl,"users/me"),{method:"PATCH",headers:t.headers,body:JSON.stringify({name:e,about:o})}).then((function(e){return e}))}(o,r).then((function(e){b.textContent=e.name,S.textContent=e.about,L.name.value=b.textContent,L.description.value=S.textContent})).catch((function(e){console.error("Произошла ошибка:",e)})).finally((function(){w(!1,e),i(f)}))})),v.addEventListener("click",(function(){L.name.value=b.textContent,L.description.value=S.textContent,u(f),_(L,U)})),h.addEventListener("click",(function(e){u(m),_(E,U)})),E.addEventListener("submit",(function(e){e.preventDefault(),w(!0,e);var o,a,u={name:e.target.place__name.value,link:e.target.link.value};(o=u.name,a=u.link,n("".concat(t.baseUrl,"cards"),{method:"POST",headers:t.headers,body:JSON.stringify({name:o,link:a})}).then((function(e){return console.log(e),e}))).then((function(t){var n={name:t.name,link:t.link,alt:t.name,_id:t._id,owner:{_id:t.owner._id},likes:t.likes||[]};O(n,j,P,r,c,D),w(!1,e),i(m),e.target.reset()})).catch((function(t){console.error("Произошла ошибка:",t),w(!1,e)}))})),y.forEach((function(e){var t=e.closest(".popup");e.addEventListener("click",(function(){return i(t)}))}));var N,O=function(t){var n=function(t,n,o,r,c,i){var u,s,l=a.cloneNode(!0),d=l.querySelector(".card"),p=l.querySelector(".card__delete-button"),_=l.querySelector(".card__like-button"),f=l.querySelector(".card__image"),m=l.querySelector(".card__title"),v=l.querySelector(".card__like-qty"),h=t._id;return d.setAttribute("id",h),u=t.likes,s=e,u.some((function(e){return e._id===s}))&&_.classList.add("card__like-button_is-active"),t.owner._id===e?p.addEventListener("click",n):p.remove(),f.src=t.link,f.alt=t.name,m.textContent=t.name,v.textContent=t.likes.length,_.addEventListener("click",(function(e){i(e.target,v,r,c,t._id)})),f.addEventListener("click",o),l}(t,j,P,r,c,D);T.prepend(n)},j=function(e){var o,r=e.target.closest(".card");(o=r.id,n("".concat(t.baseUrl,"cards/").concat(o),{method:"DELETE",headers:t.headers}).then((function(e){return e}))).then((function(){r.remove()})).catch((function(e){return console.error("Произошла ошибка:",e)}))},B=[function(){n("".concat(t.baseUrl,"users/me"),{method:"GET",headers:t.headers}).then((function(t){return n=t._id,e=n,t;var n})).then((function(e){b.textContent=e.name,S.textContent=e.about,k.style["background-image"]='url("'.concat(e.avatar,'")'),L.name.value=e.name,L.description.value=e.about})).catch((function(e){return console.error("Произошла ошибка:",e)}))},function(){n("".concat(t.baseUrl,"cards"),{method:"GET",headers:t.headers}).then((function(e){e.reverse().forEach((function(e){O(e)}))})).catch((function(e){return console.log(e)}))}];Promise.all(B).then((function(e){return e.forEach((function(e){return e()}))})).catch((function(e){return console.error("Произошла ошибка:",e)})),N=U,Array.from(document.querySelectorAll(N.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),Array.from(e.querySelectorAll(".popup__form__set")).forEach((function(e){!function(e){var t=Array.from(e.querySelectorAll(".popup__input")),n=e.querySelector(".popup__button");p(t,n),t.forEach((function(o){o.addEventListener("input",(function(){!function(e,t){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?d(e,t):function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add("popup__input_error"),o.textContent=n,o.classList.add("popup__form__input-error_active")}(e,t,t.validationMessage)}(e,o),p(t,n)}))}))}(e)}))}))})();